error_log  logs/error.log;
# use this for load balancing

upstream web{
	server web:80;
}

# upstream ydf-test{
#     server ydf-test:80;
# }

upstream davv-qa{
    server apache-davv-test:80;
}

upstream davv-myadmin{
    server myadmin-davv-test:80;
}

upstream bidec{
    server bidec_wordpress:80;
}
###################################################
# FOR WEB2PY - DAMP
###################################################
server{
	listen 80;
    server_name damp-test.bidec.in www.damp-test.bidec.in;
    access_log logs/damp-test.log main;
	location /{
		proxy_pass https://web;
	}
}

server {
    listen 443;
    server_name damp-test.bidec.in www.damp-test.bidec.in;
    access_log logs/damp-test.log main;

    # root html;
    # index index.html index.htm;

    ssl on;
    ssl_certificate /etc/nginx/ssl/server.crt;
    ssl_certificate_key /etc/nginx/ssl/server.key;

    ssl_session_timeout 5m;

    #ssl_protocols SSLv3 TLSv1 TLSv1.1 TLSv1.2;
    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
    ssl_ciphers "HIGH:!aNULL:!MD5 or HIGH:!aNULL:!MD5:!3DES";
    ssl_prefer_server_ciphers on;

    location / {
       proxy_pass https://web;
    }
}

###################################################
# FOR YDF
###################################################
# server{
#     listen 80;
#     server_name ydf-test.bidec.xyz www.ydf-test.bidec.xyz;
#     access_log logs/ydf-test.log main;
#     location /{
#         proxy_pass http://ydf-test;
#     }
# }

# server {
#     listen 443;
#     server_name ydf-test.bidec.xyz www.ydf-test.bidec.xyz;
#     access_log logs/ydf-test.log main;

#     # root html;
#     # index index.html index.htm;

#     ssl on;
#     ssl_certificate /etc/nginx/ssl/server.crt;
#     ssl_certificate_key /etc/nginx/ssl/server.key;

#     ssl_session_timeout 5m;

#     #ssl_protocols SSLv3 TLSv1 TLSv1.1 TLSv1.2;
#     ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
#     ssl_ciphers "HIGH:!aNULL:!MD5 or HIGH:!aNULL:!MD5:!3DES";
#     ssl_prefer_server_ciphers on;

#     location / {
#         proxy_pass http://ydf-test;
#     }
# }


###################################################
# FOR DAVV
###################################################
server{
    listen 80;
    server_name davv-qa.bidec.xyz www.davv-qa.bidec.xyz;
    access_log logs/davv-qa.log main;
    location /{
        proxy_pass http://davv-qa;
    }
}

server {
    listen 443;
    server_name davv-qa.bidec.xyz www.davv-qa.bidec.xyz;
    access_log logs/davv-qa.log main;

    # root html;
    # index index.html index.htm;

    ssl on;
    ssl_certificate /etc/nginx/ssl/server.crt;
    ssl_certificate_key /etc/nginx/ssl/server.key;

    ssl_session_timeout 5m;

    #ssl_protocols SSLv3 TLSv1 TLSv1.1 TLSv1.2;
    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
    ssl_ciphers "HIGH:!aNULL:!MD5 or HIGH:!aNULL:!MD5:!3DES";
    ssl_prefer_server_ciphers on;

    location / {
        proxy_pass http://davv-qa;
    }
}

###################################################
# FOR DAVV MYADMIN
###################################################
server{
    listen 80;
    server_name davv-myadmin.bidec.xyz www.davv-myadmin.bidec.xyz;
    access_log logs/davv-myadmin.log main;
    location /{
        proxy_pass http://davv-myadmin;
    }
}

server {
    listen 443;
    server_name davv-myadmin.bidec.xyz www.davv-myadmin.bidec.xyz;
    access_log logs/davv-myadmin.log main;

    # root html;
    # index index.html index.htm;

    ssl on;
    ssl_certificate /etc/nginx/ssl/server.crt;
    ssl_certificate_key /etc/nginx/ssl/server.key;

    ssl_session_timeout 5m;

    #ssl_protocols SSLv3 TLSv1 TLSv1.1 TLSv1.2;
    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
    ssl_ciphers "HIGH:!aNULL:!MD5 or HIGH:!aNULL:!MD5:!3DES";
    ssl_prefer_server_ciphers on;

    location / {
        proxy_pass http://davv-myadmin;
    }
}


###################################################
# FOR BIDEC . IN/XYZ 
###################################################
server{
    listen 80;
    server_name bidec.in bidec.xyz;
    access_log logs/bidec_main.log main;
    location /{
        proxy_pass http://bidec;
    }
    location ~ \.php$ {    
        fastcgi_split_path_info ^(.+\.php)(/.+)$;    
        fastcgi_pass wordpress:9000;    
        fastcgi_index index.php;    
        include fastcgi_params;    
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;    
        fastcgi_param SCRIPT_NAME $fastcgi_script_name;  
    }
}

server {
    listen 443;
    server_name bidec.in bidec.xyz;
    access_log logs/bidec_main.log main;

    # root html;
    # index index.html index.htm;

    ssl on;
    ssl_certificate /etc/nginx/ssl/server.crt;
    ssl_certificate_key /etc/nginx/ssl/server.key;

    ssl_session_timeout 5m;

    #ssl_protocols SSLv3 TLSv1 TLSv1.1 TLSv1.2;
    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
    ssl_ciphers "HIGH:!aNULL:!MD5 or HIGH:!aNULL:!MD5:!3DES";
    ssl_prefer_server_ciphers on;

    location / {
        proxy_pass http://bidec;
    }
}
